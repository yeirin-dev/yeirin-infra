# =============================================================================
# Yeirin Backend - Docker Compose (Development Override)
# =============================================================================
#
# 개발 환경 설정:
# - 로컬 이미지 빌드
# - 디버그 모드 활성화
# - 볼륨 마운트로 핫 리로드
# - PostgreSQL 포트 노출 (로컬 접속용)
#
# 사용법:
# docker-compose -f docker-compose.yml -f docker-compose.dev.yml up --build
# =============================================================================

version: "3.8"

services:
  # ===========================================================================
  # Nginx - 개발 환경 설정
  # ===========================================================================
  nginx:
    volumes:
      - ./nginx/nginx.dev.conf:/etc/nginx/nginx.conf:ro
    ports:
      - "80:80"
      # HTTPS는 개발환경에서 선택적
      # - "443:443"

  # ===========================================================================
  # API Gateway - 개발 환경 설정
  # ===========================================================================
  api-gateway:
    build:
      context: ../../backend/yeirin
      dockerfile: Dockerfile
      target: development
    image: yeirin/api-gateway:dev
    environment:
      - NODE_ENV=development
      - LOG_LEVEL=debug
    volumes:
      - ../../backend/yeirin/src:/app/src:ro
    ports:
      - "3000:3000" # 직접 접근 허용 (디버깅용)

  # ===========================================================================
  # Yeirin AI - 개발 환경 설정
  # ===========================================================================
  yeirin-ai:
    build:
      context: ../../backend/yeirin-ai
      dockerfile: Dockerfile
      target: development
    image: yeirin/yeirin-ai:dev
    environment:
      - ENVIRONMENT=development
      - LOG_LEVEL=DEBUG
    volumes:
      - ../../backend/yeirin-ai/yeirin_ai:/app/yeirin_ai:ro
    ports:
      - "8001:8001" # 직접 접근 허용 (디버깅용)

  # ===========================================================================
  # Soul-E - 개발 환경 설정
  # ===========================================================================
  soul-e:
    build:
      context: ../../backend/soul-e
      dockerfile: Dockerfile
      target: development
    image: yeirin/soul-e:dev
    environment:
      - ENVIRONMENT=development
      - LOG_LEVEL=DEBUG
    volumes:
      - ../../backend/soul-e/src:/app/src:ro
    ports:
      - "8000:8000" # 직접 접근 허용 (디버깅용)

  # ===========================================================================
  # PostgreSQL - 개발 환경 설정
  # ===========================================================================
  postgres:
    ports:
      - "5432:5432" # 로컬 DB 클라이언트 접근 허용

  # ===========================================================================
  # Redis - 개발 환경 설정
  # ===========================================================================
  redis:
    ports:
      - "6379:6379" # 로컬 Redis 클라이언트 접근 허용
